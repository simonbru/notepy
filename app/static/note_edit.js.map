{"version":3,"sources":["../jsx/note_edit.js"],"names":[],"mappings":"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","file":"note_edit.js","sourcesContent":["var NoteApp = React.createClass({\n\tmixins: [React.addons.PureRenderMixin],\n\n\tgetInitialState: function() {\n\t\treturn {\n\t\t\tisSaving: false,\n\t\t\tdirty: false,\n\t\t\ttextContent: \"\",\n\t\t\tlastSaved: Date.now()\n\t\t};\n\t},\n\n\tcomponentWillMount: function() {\n\t\t$.get('/api/notes/'+note_name+'/get')\n\t\t.success((data) => {\n\t\t\tif (data.note_content.length == 0)\n\t\t\t\treturn;\n\t\t\tthis.setState({\n\t\t\t\ttextContent: data.note_content,\n\t\t\t});\n\t\t});\n\n\t\t$(window).bind('keydown', (event) => {\n\t\t\tif (event.ctrlKey || event.metaKey) {\n\t\t\t\tswitch (String.fromCharCode(event.which).toLowerCase()) {\n\t\t\t\tcase 's':\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tthis.save();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$(window).bind('beforeunload', (event) => {\n\t\t\tif (!this.state.dirty)\n\t\t\t\treturn;\n\n\t\t\tthis.save();\n\t\t\tvar message = 'Il y a des modifications non sauvegardées.';\n\t\t\tif (typeof event == 'undefined') {\n\t\t\t\tevent = window.event;\n\t\t\t}\n\t\t\tif (event) {\n\t\t\t\tevent.returnValue = message;\n\t\t\t}\n\t\t\treturn message;\n\t\t});\n\t},\n\n\trender: function() {\n\t\treturn (\n\t\t<form id=\"note_edit_form\">\n\t\t\t<SaveStateLabel\n\t\t\t\tisSaving={this.state.isSaving}\n\t\t\t\tdirty={this.state.dirty}\n\t\t\t/>\n\t\t\t<br/>\n\t\t\t<NoteContent\n\t\t\t\ttext={this.state.textContent}\n\t\t\t\tonChange={this.onTextChange}\n\t\t\t/>\n\t\t</form>\n\t\t);\n\t},\n\n\tonTextChange: function(text) {\n\t\tthis.setState({\n\t\t\ttextContent: text,\n\t\t\tdirty: true\n\t\t});\n\t\t//Defer saving\n\t\tif (this.timeout)\n\t\t\tclearTimeout(this.timeout);\n\t\tthis.timeout = setTimeout(() => this.save(), 1500);\n\t},\n\n\tsave: (function() {\n\t\t// Put jqXHR in a closure\n\t\tvar jqXHR;\n\t\treturn function() {\n\t\t\tconsole.log(\"save\");\n\t\t\tclearTimeout(this.timeout);\n\t\t\t// Abort previous saving request\n\t\t\tif(jqXHR) {\n\t\t\t\tjqXHR.abort();\n\t\t\t}\n\t\t\tthis.setState({isSaving: true});\n\t\t\tjqXHR = $.post('/api/notes/'+note_name+'/put',\n\t\t\t\t$.param({note_content: this.state.textContent}))\n\t\t\t.done(() => {\n\t\t\t\tthis.setState({\n\t\t\t\t\tdirty: false,\n\t\t\t\t\tisSaving: false\n\t\t\t\t});\n\t\t\t\tconsole.log(\"sauvegarde réussie\");\n\t\t\t})\n\t\t\t.fail((xhr,textStatus,err) => {\n\t\t\t\tif (textStatus == \"abort\") {\n\t\t\t\t\t// It just means another request has replaced us,\n\t\t\t\t\t// so don't do anything\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.setState({\n\t\t\t\t\tisSaving: false\n\t\t\t\t});\n\t\t\t\talert(\"Erreur lors de la sauvergarde: \"+err+\"\\n\"+xhr.responseText);\n\t\t\t\tconsole.log(xhr.responseText);\n\t\t\t});\n\t\t};\n\t})()\n});\n\n\nvar SaveStateLabel = ({isSaving, dirty}) => {\n\t// var classes = React.addons.classSet({\n\t\t// 'label': true,\n\t\t// 'pull-right': true,\n\t\t// 'label-asd': true\n\t// });\n\tvar labelClass = text = \"\";\n\tif (isSaving) {\n\t\tvar labelClass = 'label-warning';\n\t\tvar text = \"Sauvegarde en cours\";\n\t} else if (dirty) {\n\t\tvar labelClass = 'label-danger';\n\t\tvar text = \"Modifications non enregistrées\";\n\t}\n\treturn <span className={\"label pull-right \"+labelClass}>{text}</span>;\n};\n\n\nvar NoteContent = React.createClass({\n\tmixins: [React.addons.PureRenderMixin],\n\n\tonChange: function(evt) {this.props.onChange(evt.target.value)},\n\n\trender: function() {\n\t\treturn <textarea\n\t\t\tclassName=\"form-control\"\n\t\t\tid=\"note_content\"\n\t\t\tonChange={this.onChange}\n\t\t\tvalue={this.props.text}\n\t\t\tref=\"noteContent\"\n\t\t\t/>;\n\t},\n\n\tcomponentDidUpdate: function() {\n\t\tvar elem = $(this.refs.noteContent);\n\n\t\t// ugly but works well\n\t\t/*elem.height(\"0px\");\n\t\telem.height(elem.prop('scrollHeight'));\n\t\treturn;*/\n\n\t\t// More optimized but buggy\n\t\tif (this._oldScrollHeight != elem.prop('scrollHeight')) {\n\t\t\tvar win = $(window);\n\t\t\tvar oldWinScroll = win.scrollTop();\n\n\t\t\telem.height(\"0px\");\n\t\t\telem.height(elem.prop('scrollHeight'));\n\t\t\twin.scrollTop(oldWinScroll);\n\n\t\t\t//console.log(this._oldScrollHeight, \" vs \", elem.prop('scrollHeight'));\n\t\t\tthis._oldScrollHeight = elem.prop('scrollHeight');\n\t\t}\n\t}\n});\n\n//$(document).ready(() => {\n$(window).on('load', () => {\n\twindow.noteApp = ReactDOM.render(<NoteApp/>, document.getElementById(\"note_app\"));\n});\n"]}